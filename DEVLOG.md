# 开发者笔记

> 思考记录和碎碎念
>
> Let's compose the world~

---

总的来说整套系统要分成两部分

存和取

* 存 - check in item(s)
  * 宏观而言，这个子系统的输入是单一视频模态的信息，输出是一个结构化的资料库item
  * 那这个过程又可以分成两部分了，一部分是tokenization，一部分是recomposition
  * 哦对，整体来讲这个子系统主要是偏向service层
* 取 - borrow out item(s)
  * 宏观而言，这个子系统的输入是一个或多个结构化资料库item，然后输出（具体暂且不论）
  * 整体来讲这个子系统相对会偏向UI层

关于取这一块，毕竟理论上我直接把structural item全丢给llm，他也肯定能给我生成出来东西

~~大不了prompt engineering一波就能打遍天下无敌手~~

就先忽略borrow out的部分了，首先只实现check in的部分

## 存

> P.S. 刚刚写了半天都写完了，准备跑AI回过头一看，忘了告诉怎么从url提取视频地址了
>
> 这都好说，经过刚刚一顿search，找到一个bilibili web端API逆向成果汇总
>
> 所以汇总出来所有的API，如视频流提取、作者提取、标签提取之类的，需要完全参考docs/bilibili-API-collect-master/*中包含的所有内容，选取我们需要的API，按照他里面给出的规范去调用就好啦

上回说到，存的部分又可以分成两个part

tokenization和recomposition

~~这玩意儿真挺像构建RAG的，先分词，再标记+存储~~

### tokenization

那tokenization试试先直接用现有RAG的分词器吧

那分词，分的内容是啥，最终给到tokenizer的肯定是文本

但是在文本之前，也不一定是直接口白转文本或者导出字幕的

> 这里深入想一下，其实会有很多种可能，
>
> 极端地好的情况当然是，比如原视频是一个纯知识干货，口白转文本之后直接是一本完全文稿了
>
> 那这个都不用处理，直接丢RAG存就行
>
> 但是极端地坏的情况是假设user是一个摄影师，他想资产化一个讲摄影光影技术的个人up的实操讲解教程
>
> 可能几乎没有术语，甚至没有关键词，这个时候就需要在视频转文本的过程中pre-think一下
>
> 更具体地，视频里的信息可能是各种模态
>
> 图像，动画，音频（非口白）
>
> 这里，推荐使用ffmpeg来解决指定时间点或时间段的画面抽取，其中时间点画面应当提取为jpg格式，时间段的画面应当抽取为无分辨率压缩的动图格式（优先）或mp4格式（这两种格式的选择主要依据片段内旁白或音频是否必要，这个具体的决策流程和判断标准还需要再考虑一下）
>
> 图像里面的物体分类识别首先可能选择yolo这种
>
> * [ ] 动画的话可能涉及类似RNN的结构，额，挖个坑以后填，这个应该不是主要情况
> * [ ] 音频的话，额，同动画

那为了后面填上各种模态信息的坑，这里最好就设立一个标准化的，但是区分出来单一模态的RAW数据

那如果我在整个RAW数据里的每一处都标上时间点，只需要对文本切片，那绑定的同位置的其他模态数据也可以跟着被切片咯

那这里其实同样会有一些极端的情况，比如假如说一些艺术性质的视频，基于画面内容切片，绑定文字到画面，他的逻辑通顺性和完整性可能比，基于文本切片，绑定画面到文字，更好

所以我们最好还是对各个模态一视同仁，也就是说我可以选择以任何一种模态作为base，把其他模态的RAW数据按照时间位置hook到base模态的对应位置上，然后只针对base模态切片，即可实现多模态全片切片

至于这个选择那我先不管了，先默认文本，后面简单写个机器学习分类器，这都好说

* [ ] 切片base分类器，挖个坑有空填

P.S. 为了方便下文描述，这里补充一下初步预期的工程实现定义

分割出来的多个切片，包含原片在各种模态下、在同一时间点或时间范围的内容

为了存储这个切片，我们在MilanoBook类下面定义一个Paragraph子类用于存储之

### recomposition

说完了tokenization，再说说recomposition

那我获取了全片切片后的数据，我是不是要把他相当于塞到一个标准化的容器里

这个容器的宏观结构是完全动态的，随着数据的不同而适应

但是另一方面，这个容器的微观结构则是相对固定的，

几乎就是一个可以动态地塞不同类型item的base class

这里的item type属于是一些最小的知识单元

比如一坨扁平列表化的内容，比如（如题目提示）时间线，故事线，逻辑关系……

这玩意儿也是一个可以扩充的东西

工程上的实现几乎是呼之欲出，假设使用python的话，实现如下的类定义文件结构：

```
 - MilanoBook/
   - __init__.py		-> class MilanoBook(self, ...)
   - Item/
     - __init__.py		-> class Item(self, ...)
     - StuffList.py		-> class StuffList(Item, ...)
     - Timeline.py		-> class Timeline(Item, ...)
     - RelationGraph.py		-> class RelationGraph(Item, ...)
     - ... ...
```

整个流程顺下来，可能乍一看觉得，怎么不同的Item难道是无序平铺地存储在MilanoBook里面的吗？

那这里就要提到刚刚*~~发呆愣神半夜打瞌睡~~*想到的一个很妙的idea了

数据结构这块有一个东西叫链表，C++实现链表是最直观的，他用指针（pointer）实现一个类似于hook的机制

那我MilanoBook里面，不同Item里面的内容，是不是也可以跨Item甚至是跨层级地去hook？

举个例子，可能视频里先用一个时间线讲了上世纪50年代到千禧年这段时间里，计算机操作系统发展的整体情况，然后视频分段讲了很多个故事，比如Unix怎么诞生的，Linus怎么迭代Linux的，Apple和Microsoft怎么度完蜜月又互掐的（假设就这仨故事），那我其实有如下的预期实现目标：

> MilanoBook类型对象mb1，其内部创建并存储有：
>
> * 四个Timeline对象：
>   * tl1：按顺序存储sl1对象，sl2，sl3
>   * tl2：按顺序存储Unix开发过程中的部分内容，即多个MilanoBook.Paragraph对象
>   * tl3：如上
>   * tl4：以此类推
> * 三个StuffList对象：
>   * sl1：存储Unix开发过程中的事情（扁平化故事），即多个MilanoBook.Paragraph对象
>   * sl2：存储Linux迭代过程中的事情（同上）
>   * sl3：（以此类推）
> * 一个RelationGraph对象：
>   * rg1：用某种可以表示逻辑关系的图的结构存储了几个相关的MilanoBook.Paragraph对象

一股脑写完上面这一坨，再一想怎么实现，忽然觉得弱类型语言真的是

伟大，无需多言

爱你老Py

书归正传，其实到这里recomposition的逻辑部分就构思的差不多了，不过放在内存里的内容如何本地化存储，这个就交给AI给我推个合适的路子了

## 取

如上所说，配合着prompt engineering一波，把MilanoBook对象一股脑丢给llm就行，先这么做就好

## UI

那无论是存还是取，总得有一个UI控制整个流程

我目前还是维持我一贯的观点，直接用前端作为UI的技术栈，这个路子天生就可以跨端适配、改成云端服务+本地终端的模式，反正除了写router麻烦，其他的方面怎么想都是利大于弊的

所以还是选用flask作为最简的UI服务器实现，通过给页面上不同控件绑定router的方式，实现前端UI交互与后端上述各种service的互通

## 截止到这里

我们暂且先构思以上部分，现在需要将上述所有部分按照构思描述，进行完整的代码与工程实现。对于以上没有提到或者提到可以先跳过的部分，不需要实现。不需要考虑针对整个项目业务的完整性或其他不必要的安全性问题，只需要你的工程实现能够满足执行上述提到的业务，并且可以顺利跑通。
